/******************************************************************************
 * @file        str_ww_ref_model_depthwise_conv_2.c
 * @brief       Autogenerated AOT DEPTHWISE_CONV_2D kernel
 * @details     This file was generated by HeliosAOT v0.2.2 on 2025-08-05.
 *   This kernel represents node #2 in the corresponding graph.
 *
 * @date        2025-08-05
 *
 * @copyright
 *   © 2025 Ambiq. All rights reserved.
 *
 *   This generated C module is licensed for use **only** on Ambiq hardware
 *   incorporating Ambiq’s sub-threshold power optimized technology.
 *   Any other use is strictly prohibited.
 *
 *   See “LICENSE.txt” at the root of this distribution for full terms.
 *
 * @note        Do not edit this file—any changes will be overwritten.
 ******************************************************************************/
#include <stdalign.h>
#include "ns_ambiqsuite_harness.h"
#include "arm_nnfunctions.h"
#include "arm_nnsupportfunctions.h"
#include "str_ww_ref_model_depthwise_conv_2.h"

#if defined(ARM_MATH_MVEI)
#define SCRATCH_BUFFER_SIZE 2480
#define WEIGHT_SUM_BUFFER_SIZE 512
#elif defined(ARM_MATH_DSP)
#define SCRATCH_BUFFER_SIZE 0
#define WEIGHT_SUM_BUFFER_SIZE 0
#else
#define SCRATCH_BUFFER_SIZE 0
#define WEIGHT_SUM_BUFFER_SIZE 0
#endif

// Input dimensions: input shape is [1, H_IN, W_IN, C_IN]
static const cmsis_nn_dims dw_2_input_dims = { .n = 1, .h = 1, .w = 28, .c = 128 };

// Filter dimensions: weights shape is [1, H_FILT, W_FILT, C_OUT].
static const cmsis_nn_dims dw_2_filter_dims = { .n = 1, .h = 1, .w = 5, .c = 128 };

// Bias dimensions: bias shape is [1, 1, 1, C_OUT].
static const cmsis_nn_dims dw_2_bias_dims = { .n = 1, .h = 1, .w = 1, .c = 128 };

// Output dimensions: output shape is [1, H_OUT, W_OUT, C_OUT].
static const cmsis_nn_dims dw_2_output_dims = { .n = 1, .h = 1, .w = 24, .c = 128 };

// Quantization parameters (per-channel quantization)
static const int32_t dw_2_multiplier[128] = {
    1899265904, 1267388549, 1772839238, 1423204880, 1465111259, 2020025058, 1557387502, 1775078657, 1961836574, 1728959427, 1175218747, 1874407424, 1829562443, 1897886200, 1168367875, 1231766701, 1696022712, 1293149533, 1450401708, 2042012608,
    1611336430, 1803308480, 1185302507, 1863418505, 1101154572, 1313957515, 1900864557, 1349590364, 1573806470, 1198016093, 1393192201, 1560151308, 1611572071, 1850891170, 1924437255, 1564008195, 1921294573, 1716468508, 2012401868, 1343149473,
    1985047542, 2024645008, 1321331560, 1167002890, 1423079701, 1893555453, 1650434090, 1564747284, 1657145216, 1282798194, 1384496566, 1824303396, 1075498055, 1483950816, 1863042815, 1507646114, 1338751811, 1456875980, 1261177305, 1890935337,
    1453104367, 1688205911, 1770683879, 1457639043, 1226271482, 1422639829, 1075860544, 1447810422, 1526750140, 1155073533, 1517294022, 1626653366, 1335660869, 1149116138, 1475867876, 1426172615, 1369804465, 1804178059, 1922167338, 2076899540,
    1419603207, 1638454054, 1604521671, 1437793652, 1329563046, 1561977257, 1326412928, 1623275953, 1566609193, 1709443902, 1406608536, 1317889813, 1327063557, 1858442287, 1951194363, 1662922429, 2058833364, 1328549776, 2057651368, 1826139055,
    1526231215, 1994140413, 2114915803, 2104729700, 1365878084, 1935897000, 1723926158, 1567644312, 1470890141, 1789569714, 1145322068, 1456197736, 1570455459, 1532464688, 1371561981, 2124499680, 1659499800, 1759936669, 1693675107, 1209917911,
    1630114990, 1761706173, 1647820346, 1782695930, 1763370830, 1438517568, 1871684282, 1356677331
};
static const int32_t dw_2_shift[128] = {
    -8, -8, -8, -8, -8, -9, -8, -8, -8, -8, -7, -8, -8, -9, -8, -7, -8, -8, -8, -8,
    -8, -8, -7, -8, -7, -7, -8, -8, -8, -8, -8, -8, -8, -9, -8, -8, -8, -8, -8, -8,
    -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -7, -8, -8, -8, -8, -8, -8, -8,
    -8, -8, -8, -8, -8, -8, -7, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8,
    -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -7, -8, -8, -8, -8, -8, -9, -8,
    -8, -8, -9, -8, -8, -8, -8, -8, -7, -8, -7, -8, -8, -8, -8, -8, -8, -8, -8, -8,
    -8, -8, -8, -8, -8, -8, -8, -8
};

// Offsets and activation parameters.
static const int32_t dw_2_input_zero_point = -128;
static const int32_t dw_2_output_zero_point = -2;


// Weight and bias data.
alignas(16) static NS_PUT_IN_TCM int8_t dw_2_weights[] = {
    6, -55, 110, -54, 83, 108, -73, 23, -15, -19, 13, 79, -48, 94, 12, 127, 18, 127, -41, 127,
    127, 127, 33, -80, -12, 28, -127, -127, 7, -127, 75, 22, 6, -127, -34, 127, -127, -24, 127, -127,
    127, -40, -93, -4, -80, -43, 71, 127, -42, -112, 37, 127, 16, 0, -31, 12, 96, 127, 127, 11,
    24, -11, -127, 45, 65, 56, -127, 72, 127, -65, -127, 14, 83, -42, 103, 1, -59, -109, 15, -127,
    -19, -26, 50, 40, 40, 7, -61, 127, 70, -68, -118, 127, -127, -66, -127, 89, 92, 127, -115, 43,
    -60, 14, -66, -127, 127, -127, -127, 127, 127, -127, 127, 113, -127, 127, 127, 22, -41, 38, -99, 113,
    50, -117, -127, -23, 127, 29, -23, 95, -23, 60, -73, -127, 51, 43, 65, 1, 65, -127, 11, 25,
    43, 118, -1, 44, -44, 68, 102, 34, 96, -24, -56, -59, 23, 73, -53, -86, 3, -91, 127, -55,
    27, -113, 45, 124, -66, 56, 106, -121, -29, 103, -108, 127, -54, -127, 82, 114, 40, 13, 23, 49,
    -72, -13, -70, 50, 79, 114, 105, -19, 127, -86, -60, 68, 127, -41, -46, -33, -33, 85, -107, 127,
    126, 124, 48, 59, -91, -86, -56, -75, 98, -48, 67, 3, -8, -127, -78, 113, -29, 2, -127, 71,
    -64, 72, -56, -31, 9, 87, -124, 75, 68, 31, -65, -42, 114, -4, -69, 95, 28, -85, 8, -1,
    -98, 9, 93, -1, -122, -46, -72, 124, 0, -107, -1, 127, 55, -47, -48, 37, -43, 11, -68, -88,
    -25, -64, 127, 127, 127, 54, -39, 127, 127, 127, 83, -29, -95, -41, 127, -40, 65, -79, -35, -4,
    1, 10, -10, -64, 35, -11, 45, 4, 12, -106, -30, 69, 10, 77, -3, -18, -88, 127, -92, 66,
    -17, -66, 57, 13, 52, 115, 66, -33, -127, -67, 40, -4, 127, 28, -15, -51, 84, -127, -36, 20,
    44, 56, 8, -127, -101, 88, -26, 24, 45, 127, -57, -33, -87, 11, -98, 64, 127, -96, 70, -83,
    -58, -105, 46, 87, 30, 15, -28, 12, -48, -11, -83, -127, -12, 23, -104, -31, 82, 49, 58, -96,
    99, 80, -52, -24, -14, 52, -31, -127, -96, -60, 96, 51, -41, -80, -16, 45, -118, 1, 23, 101,
    -89, -59, 68, 55, -78, -127, 18, 88, -15, 82, 23, 119, 85, 120, 17, 73, 53, 7, 127, -57,
    -127, -82, 40, -37, 27, -55, 30, 113, -57, -19, 48, -25, 71, 7, -9, 71, -77, -120, -100, 77,
    43, -1, 59, 84, -34, 12, 42, 72, 72, 54, -81, -24, -52, 114, 127, -86, -76, -111, 57, -32,
    104, -33, -86, 39, 78, -77, -9, -115, 100, 88, -14, -122, -66, 127, 9, -75, -40, 80, -101, -127,
    -127, 76, -127, 53, 124, -100, -41, -75, -85, 21, 114, 5, 95, 51, -32, -100, -9, -127, -28, 18,
    -71, -64, -96, -127, 127, 93, 127, -42, -81, 60, -41, -106, -7, 84, -57, -73, -44, -44, 90, -11,
    41, -72, 127, 28, -127, 78, 40, 42, -95, -78, 97, 103, -127, -124, 127, 74, 127, 127, 21, 21,
    -23, 65, 127, -4, -69, -24, 103, -70, -29, -83, -27, 21, 34, -29, 127, 127, -127, -127, -23, -99,
    127, 43, -9, 127, -127, -112, -127, -61, 59, -127, 46, 122, 72, -50, 127, 52, 127, 26, -127, -66,
    -127, 127, 86, -64, 5, -127, 127, -127, 29, -28, -115, 127, 69, -35, 51, -127, 98, 127, -31, -14,
    43, 55, 53, -95, -127, 120, -127, -90, -51, 127, -60, 25, 27, -127, -127, -127, -127, 71, 127, -103,
    127, 127, 7, -101, 47, -92, 14, 12, -127, -22, -127, -117, -85, 127, 92, -82, -72, 20, 25, -85,
    -12, 91, 48, -116, 23, -78, -13, -127, 127, -127, 72, -127, -38, 127, 100, 24, 41, -127, 127, 127
};

alignas(16) static NS_PUT_IN_TCM int32_t dw_2_bias[] = {
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0
};

alignas(16) static NS_PUT_IN_TCM int8_t dw_2_scratch_buffer[SCRATCH_BUFFER_SIZE];
alignas(16) static NS_PUT_IN_TCM int8_t dw_2_weight_sum_buffer[WEIGHT_SUM_BUFFER_SIZE];

static cmsis_nn_context dw_2_ctx = {
    .buf = dw_2_scratch_buffer,
    .size = sizeof(dw_2_scratch_buffer),
};

static cmsis_nn_context dw_2_weight_sum_ctx = {
    .buf = dw_2_weight_sum_buffer,
    .size = sizeof(dw_2_weight_sum_buffer),
};


const cmsis_nn_per_channel_quant_params dw_2_quant_params = {
    .multiplier = (int32_t*)dw_2_multiplier,
    .shift = (int32_t*)dw_2_shift,
};

const cmsis_nn_dw_conv_params dw_2_dw_conv_params = {
    .input_offset = -dw_2_input_zero_point,
    .output_offset = dw_2_output_zero_point,
    .ch_mult = 1,
    .stride.w = 1,
    .stride.h = 1,
    .padding.w = 0,
    .padding.h = 0,
    .dilation.w = 1,
    .dilation.h = 1,
    .activation.min = -128,
    .activation.max = 127,
};

int32_t
str_ww_ref_model_depthwise_conv_2_init(void) {
    return arm_depthwise_convolve_weight_sum(
        (int32_t *)dw_2_weight_sum_buffer,
        NULL, // No scratch buffer required
        dw_2_weights,
        &dw_2_dw_conv_params,
        &dw_2_input_dims,
        &dw_2_filter_dims,
        &dw_2_output_dims,
        dw_2_dw_conv_params.input_offset,
        dw_2_bias
    );
}


int32_t
str_ww_ref_model_depthwise_conv_2_run(
    const int8_t* __restrict input,
    int8_t* __restrict output
) {

    return arm_depthwise_conv_wrapper_s8(
        &dw_2_ctx,
        &dw_2_weight_sum_ctx,
        &dw_2_dw_conv_params,
        &dw_2_quant_params,
        &dw_2_input_dims,
        input,
        &dw_2_filter_dims,
        dw_2_weights,
        &dw_2_bias_dims,
        dw_2_bias,
        &dw_2_output_dims,
        output
    );

}