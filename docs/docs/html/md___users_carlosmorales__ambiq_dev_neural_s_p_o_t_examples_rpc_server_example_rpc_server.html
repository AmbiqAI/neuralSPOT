<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ambiq NeuralSPOT: RPC Generic Data Operations Server Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="am_intelligence.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ambiq NeuralSPOT<span id="projectnumber">&#160;Beta</span>
   </div>
   <div id="projectbrief">NeuralSPOT is Ambiq&#39;s collection of AI libraries and tools</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md___users_carlosmorales__ambiq_dev_neural_s_p_o_t_examples_rpc_server_example_rpc_server.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RPC Generic Data Operations Server Example </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >RPC, or remote procedure calls, is a way for code running on two different CPUs (in this case, a PC and an EVB connected via USB) to call procedures between each other almost as if the procedure was running locally. It does so by communicating over a transport layer - in our case, we use serial-over-USB over second USB port on the EVB.</p>
<p >The <code>rpc-server.cc</code> example shows how to use <code>ns-rpc</code> when the EVB is the <em>server</em> and the PC is the <em>client</em>. In this configuration, the PC calls remote procedures and the EVB executes those procedures . This example is designed to work with <code><a class="el" href="generic__data_8py.html">generic_data.py</a></code> (part of <code>ns-rpc</code>), a python script running on the PC that can be run as server or client.</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    participant PC</div>
<div class="line">    participant EVB</div>
<div class="line">    note over EVB: server</div>
<div class="line">    note over PC: client</div>
<div class="line">    PC-&gt;&gt;+EVB: ns_rpc_data_sendBlockToEVB(&amp;outBlock);</div>
<div class="line">    Note left of PC: generic_data.py mocks up&lt;br/&gt;a dataBlock, sends to EVB</div>
<div class="line">    Note right of EVB: The EVB prints the&lt;br&gt; block on SWO interface</div>
<div class="line">    EVB-&gt;&gt;-PC: ns_rpc_data_success</div>
<div class="line">    PC-&gt;&gt;+EVB: ns_rpc_data_fetchBlockFromEVB(&amp;returnBock)</div>
<div class="line">    Note right of EVB: Mocks up a &lt;br/&gt; dataBlock and returns</div>
<div class="line">    Note left of PC: generic_data.py prints &lt;br/&gt; the returned dataBlock</div>
<div class="line">    EVB-&gt;&gt;-PC: ns_rpc_data_success</div>
<div class="line">    PC-&gt;&gt;+EVB: ns_rpc_data_computeOnEVB(&amp;outBlock, &amp;resultBlock)</div>
<div class="line">    Note left of PC: Mocks up a &lt;br/&gt; dataBlock and sends&lt;br/&gt; to EVB</div>
<div class="line">    Note right of EVB: Multiplies the dataBlock&lt;br/&gt; by 2 and returns</div>
<div class="line">    Note left of PC: generic_data.py prints &lt;br/&gt; the resulting dataBlock</div>
<div class="line">    EVB-&gt;&gt;-PC: ns_rpc_data_success</div>
</div><!-- fragment --><p >We demonstrate the following EVB-&gt;PC procedure calls:</p>
<ul>
<li><code>ns_rpc_data_sendBlockToEVB(&amp;outBlock)</code>: Passes a generic <a class="el" href="structdata_block.html">dataBlock</a> to the EVB server. <code>dataBlock_t</code> is defined as part of the GenericDataOperations RPC interface. The example server simply prints the this block.</li>
<li><code>ns_rpc_data_fetchBlockFromEVB(&amp;inBlock)</code>: Requests a generic <a class="el" href="structdata_block.html">dataBlock</a> from the EVB server. <code>dataBlock_t</code> is defined as part of the GenericDataOperations RPC interface. The example server mocks up a small <a class="el" href="structdata_block.html">dataBlock</a> and returns it to the client, which prints it on the CLI.</li>
<li><code>ns_rpc_data_computeOnEVB(&amp;computeBlock, &amp;resultBlock)</code>: Passes a <a class="el" href="structdata_block.html">dataBlock</a> to the EVB, and gets a different <a class="el" href="structdata_block.html">dataBlock</a> in return. The two do not have to be the same shape or data type. This RPC is intended for remote computation such as calculating MFCC remotely, or testing the EVB's inference results versus the remote results. The example mocks a simple <a class="el" href="structdata_block.html">dataBlock</a> and sends it to the EVB, which multiplies it by 2 and returns it, whereupon the PC prints the the result on the CLI.</li>
</ul>
<p >It's a client/server system needing some careful staging, described below.</p>
<h1><a class="anchor" id="autotoc_md51"></a>
Installation and Setup</h1>
<p >You'll need to install some laptop-side software, including ERPC and it's python library.</p><ol type="1">
<li>Clone our erpc fork (<a href="#" onclick="location.href='mai'+'lto:'+'git'+'@g'+'ith'+'ub'+'.co'+'m'; return false;">git@g<span style="display: none;">.nosp@m.</span>ithu<span style="display: none;">.nosp@m.</span>b.com</a>:AmbiqAI/erpc.git)</li>
<li>Make erpc (instructions here: <a href="https://github.com/AmbiqAI/erpc/blob/develop/README.md#building-and-installing">https://github.com/AmbiqAI/erpc/blob/develop/README.md#building-and-installing</a>)</li>
<li>Install erpc_python (instructions here: <a href="https://github.com/AmbiqAI/erpc/tree/develop/erpc_python">https://github.com/AmbiqAI/erpc/tree/develop/erpc_python</a>)</li>
</ol>
<h1><a class="anchor" id="autotoc_md52"></a>
Running the RPC-server example</h1>
<p >Running RPC requires a bit of staging. The PC-side server cant start until the USB TTY interface shows up as a device, and that doesn't happen until we start servicing TinyUSB, and even then it doesn't happen immediately.</p>
<p >To address this, rpc-client loop swaiting for a button press, servicing USB. This gives the user a chance to start the server then pressing the button to let the EVB it is ready to start RPCing.</p>
<ol type="1">
<li>Compile and flash the NeuralSPOT rpc-server example</li>
<li>Connect the second USB cable to your laptop - you'll now have 2 USB connections between the EVB and the laptop</li>
<li>Run the rpc-server EVB code (it should be running if you flashed, unless you have something like GDB interrupting execution)</li>
<li>Monitor the EVB SWO printout - you should see "Start the PC-side client, then press Button 0 to get started"</li>
<li>At this point, the second USB connection should come alive. It will mount as a USB TTY device. On a Mac, it'll look something like <code>/dev/tty.usbmodem1234561</code>, on a windows PC it'll be <code>COMx</code> or similar. If the device doesn't pop up, there is a problem. It won't show up until "Press Button" shows up, so make sure you got that far.</li>
<li>Start the laptop-side RPC client . <div class="fragment"><div class="line">$&gt; cd neuralSPOT/neuralspot/ns-rpc/python/ns-rpc-genericdata</div>
<div class="line">$&gt; python -m generic_data -t /dev/tty.usbmodem1234561 -o myaudio.wav -m client</div>
<div class="line">Client started - press enter send remote procedure calls to EVB</div>
</div><!-- fragment --> If all went well, you can press Button 0, which will start the server. At this point you can press 'enter' on the PC, which sends the 3 example RPC calls to the EVB. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
