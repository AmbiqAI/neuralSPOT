<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ambiq NeuralSPOT: NeuralSPOT Audio Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="am_intelligence.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ambiq NeuralSPOT<span id="projectnumber">&#160;Beta</span>
   </div>
   <div id="projectbrief">NeuralSPOT is Ambiq&#39;s collection of AI libraries and tools</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_n_s-_audio.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">NeuralSPOT Audio Library </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md37">NeuralSPOT Audio Library Subsystem</a><ul><li class="level2"><a href="#autotoc_md38">Using NS Audio to Sample Audio</a></li>
<li class="level2"><a href="#autotoc_md39">Audio Inter-process Communication (IPC)</a><ul><li class="level3"><a href="#autotoc_md40">Audio IPC Modes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md37"></a>
NeuralSPOT Audio Library Subsystem</h1>
<p >This library helps implement audio-based AI features on Ambiq's platform by simplifying common operations such as:</p><ol type="1">
<li>Reading audio data from peripherals such as the low-power analog microphone input (AUDADC)</li>
<li>Calculating common input features such as Mel Spectograms</li>
<li>Transferring data between the EVB and a PC (with the help of NeuralSPOT RPC)</li>
</ol>
<p >NS-audio includes the following components:</p><ol type="1">
<li><code>ns_audio</code>: this is the front-end to the audio sampling subsystem, and provides multiple mechanisms for accessing the collected data</li>
<li><code>ns_audadc</code>: facilities for initializing and operating the AUDADC. Developers shouldn't have to access this system directly</li>
<li><code>ns_mfcc</code>: implements an optimized, C-based MFCC calculator.</li>
</ol>
<h2><a class="anchor" id="autotoc_md38"></a>
Using NS Audio to Sample Audio</h2>
<p >Briefly, sampling audio is a matter of initializing this library, hooking into its IPC, and collecting data when it is available.</p>
<p >There are several IPC methods available (see the IPC section below for more details). The following example starts sampling audio when the user presses button 0 on the EVB, and uses the NS_AUDIO_API_CALLBACK IPC method:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ns__audio_8h.html">ns_audio.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span>    <span class="keyword">static</span> g_audioRecording = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">bool</span>    <span class="keyword">static</span> g_audioReady     = <span class="keyword">false</span>;</div>
<div class="line">int16_t <span class="keyword">static</span> g_in16AudioDataBuffer[<a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a> * 2];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This will be called by an IRQ handler</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cc.html#a6fb724e06717ca9d7f2e87028b728c38">audio_frame_callback</a>(<a class="code hl_struct" href="structam__ai__acfg.html">ns_audio_config_t</a> *config, uint16_t bytesCollected) {</div>
<div class="line">    uint32_t *buffer = (uint32_t *)am_hal_audadc_dma_get_buffer(config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#a3eef71b06c97959fde3aabdd4871dcde">audioSystemHandle</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (g_audioRecording) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#a6cd8a1e15974a310b7e61116c3efee5c">numSamples</a>; i++) {</div>
<div class="line">            g_in16AudioDataBuffer[i] = (int16_t)(pui32_buffer[i] &amp; 0x0000FFF0);</div>
<div class="line">        }</div>
<div class="line">        g_audioReady = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Desired Audio Configuration </span></div>
<div class="line"><a class="code hl_struct" href="structam__ai__acfg.html">ns_audio_config_t</a> <a class="code hl_variable" href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a> = {</div>
<div class="line">    .<a class="code hl_variable" href="structam__ai__acfg.html#ab6bbd9fc037873dca9e838408f1399e7">eAudioApiMode</a> = <a class="code hl_enumvalue" href="group___neural_s_p_o_t-_audio.html#ggac323b3153cc1c87ccdacca907cc10ba7af90a19e63376aaee138c8d50b8a88989">NS_AUDIO_API_CALLBACK</a>,</div>
<div class="line">    .callback = <a class="code hl_function" href="main_8cc.html#a6fb724e06717ca9d7f2e87028b728c38">audio_frame_callback</a>, <span class="comment">// declared above</span></div>
<div class="line">    .audioBuffer = (<span class="keywordtype">void</span> *)&amp;g_in16AudioDataBuffer,</div>
<div class="line">    .eAudioSource = <a class="code hl_enumvalue" href="group___neural_s_p_o_t-_audio.html#ggac60456a745861cbe75be2504b3071f32a51878572d9b7fe3281b28a8f8856b658">NS_AUDIO_SOURCE_AUDADC</a>,</div>
<div class="line">    .numChannels = <a class="code hl_define" href="main_8cc.html#ae5597ce31d23d11493e6e674fe257d73">NUM_CHANNELS</a>,</div>
<div class="line">    .numSamples = <a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a>,</div>
<div class="line">    .sampleRate = <a class="code hl_define" href="main_8cc.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a>,</div>
<div class="line">    .audioSystemHandle = NULL,        <span class="comment">// filled in by audio_init() below</span></div>
<div class="line">    .bufferHandle = NULL</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="main_8cc.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <a class="code hl_function" href="group___neural_s_p_o_t-_audio.html#gac274892f2065523ddc26d0e1846440fb">ns_audio_init</a>(&amp;<a class="code hl_variable" href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cc.html#ad82f2cf0e099382942e06c6beed540e6">g_intButtonPressed</a> == 1) { <span class="comment">// See NS-peripherals for button info</span></div>
<div class="line">            g_audioRecording = <span class="keyword">true</span>;   <span class="comment">// Tell callback to start collecting audio</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_audioReady) {</div>
<div class="line">            <span class="comment">// The callback sets g_audioReady when g_in16AudioDataBuffer has a sample</span></div>
<div class="line">            <span class="comment">// Do something with it...</span></div>
<div class="line">            <a class="code hl_function" href="group___neural_s_p_o_t-_m_f_c_c.html#ga49b1cd702046d3eb44f34f2471f6a080">ns_mfcc_compute</a>(g_in16AudioDataBuffer, &amp;mfcc_buffer[mfcc_buffer_head]);</div>
<div class="line">            g_audioReady = <span class="keyword">false</span>;      <span class="comment">// Tell callback we&#39;re ready for more</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup___neural_s_p_o_t-_audio_html_gac274892f2065523ddc26d0e1846440fb"><div class="ttname"><a href="group___neural_s_p_o_t-_audio.html#gac274892f2065523ddc26d0e1846440fb">ns_audio_init</a></div><div class="ttdeci">void ns_audio_init(ns_audio_config_t *)</div><div class="ttdoc">Initialize NeuralSPOT audio capture library.</div><div class="ttdef"><b>Definition:</b> ns_audio.c:58</div></div>
<div class="ttc" id="agroup___neural_s_p_o_t-_audio_html_ggac323b3153cc1c87ccdacca907cc10ba7af90a19e63376aaee138c8d50b8a88989"><div class="ttname"><a href="group___neural_s_p_o_t-_audio.html#ggac323b3153cc1c87ccdacca907cc10ba7af90a19e63376aaee138c8d50b8a88989">NS_AUDIO_API_CALLBACK</a></div><div class="ttdeci">@ NS_AUDIO_API_CALLBACK</div><div class="ttdoc">App-defined callback is invoked when audio is ready.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:66</div></div>
<div class="ttc" id="agroup___neural_s_p_o_t-_audio_html_ggac60456a745861cbe75be2504b3071f32a51878572d9b7fe3281b28a8f8856b658"><div class="ttname"><a href="group___neural_s_p_o_t-_audio.html#ggac60456a745861cbe75be2504b3071f32a51878572d9b7fe3281b28a8f8856b658">NS_AUDIO_SOURCE_AUDADC</a></div><div class="ttdeci">@ NS_AUDIO_SOURCE_AUDADC</div><div class="ttdoc">Collect data from AUDADC.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:73</div></div>
<div class="ttc" id="agroup___neural_s_p_o_t-_m_f_c_c_html_ga49b1cd702046d3eb44f34f2471f6a080"><div class="ttname"><a href="group___neural_s_p_o_t-_m_f_c_c.html#ga49b1cd702046d3eb44f34f2471f6a080">ns_mfcc_compute</a></div><div class="ttdeci">void ns_mfcc_compute(const int16_t *audio_data, float *mfcc_out)</div><div class="ttdef"><b>Definition:</b> ns_mfcc.c:165</div></div>
<div class="ttc" id="amain_8cc_html_a3c9efb24bd9b867abc0aef996c03651e"><div class="ttname"><a href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a></div><div class="ttdeci">ns_audio_config_t audio_config</div><div class="ttdoc">NeuralSPOT Audio config struct.</div><div class="ttdef"><b>Definition:</b> main.cc:268</div></div>
<div class="ttc" id="amain_8cc_html_a4b76a0c2859cfd819a343a780070ee2b"><div class="ttname"><a href="main_8cc.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a></div><div class="ttdeci">#define SAMPLE_RATE</div><div class="ttdef"><b>Definition:</b> main.cc:93</div></div>
<div class="ttc" id="amain_8cc_html_a6fb724e06717ca9d7f2e87028b728c38"><div class="ttname"><a href="main_8cc.html#a6fb724e06717ca9d7f2e87028b728c38">audio_frame_callback</a></div><div class="ttdeci">void audio_frame_callback(ns_audio_config_t *config, uint16_t bytesCollected)</div><div class="ttdoc">Audio Callback (user-defined, executes in IRQ context)</div><div class="ttdef"><b>Definition:</b> main.cc:235</div></div>
<div class="ttc" id="amain_8cc_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="main_8cc.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdoc">Main function - infinite loop listening and inferring.</div><div class="ttdef"><b>Definition:</b> main.cc:296</div></div>
<div class="ttc" id="amain_8cc_html_ac51cd4ed73859c0380134f48f2878b1e"><div class="ttname"><a href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a></div><div class="ttdeci">#define SAMPLES_IN_FRAME</div><div class="ttdef"><b>Definition:</b> main.cc:92</div></div>
<div class="ttc" id="amain_8cc_html_ad82f2cf0e099382942e06c6beed540e6"><div class="ttname"><a href="main_8cc.html#ad82f2cf0e099382942e06c6beed540e6">g_intButtonPressed</a></div><div class="ttdeci">int g_intButtonPressed</div><div class="ttdoc">Button global - will be set by neuralSPOT button helper.</div><div class="ttdef"><b>Definition:</b> main.cc:196</div></div>
<div class="ttc" id="amain_8cc_html_ae5597ce31d23d11493e6e674fe257d73"><div class="ttname"><a href="main_8cc.html#ae5597ce31d23d11493e6e674fe257d73">NUM_CHANNELS</a></div><div class="ttdeci">#define NUM_CHANNELS</div><div class="ttdoc">High level audio parameters.</div><div class="ttdef"><b>Definition:</b> main.cc:90</div></div>
<div class="ttc" id="ans__audio_8h_html"><div class="ttname"><a href="ns__audio_8h.html">ns_audio.h</a></div><div class="ttdoc">API Definition for NeuralSPOT Audio library.</div></div>
<div class="ttc" id="astructam__ai__acfg_html"><div class="ttname"><a href="structam__ai__acfg.html">am_ai_acfg</a></div><div class="ttdoc">NeuralSPOT Audio API Configuration Struct.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:87</div></div>
<div class="ttc" id="astructam__ai__acfg_html_a3eef71b06c97959fde3aabdd4871dcde"><div class="ttname"><a href="structam__ai__acfg.html#a3eef71b06c97959fde3aabdd4871dcde">am_ai_acfg::audioSystemHandle</a></div><div class="ttdeci">void * audioSystemHandle</div><div class="ttdoc">Internals.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:103</div></div>
<div class="ttc" id="astructam__ai__acfg_html_a6cd8a1e15974a310b7e61116c3efee5c"><div class="ttname"><a href="structam__ai__acfg.html#a6cd8a1e15974a310b7e61116c3efee5c">am_ai_acfg::numSamples</a></div><div class="ttdeci">uint16_t numSamples</div><div class="ttdoc">Samples collected per callback.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:99</div></div>
<div class="ttc" id="astructam__ai__acfg_html_ab6bbd9fc037873dca9e838408f1399e7"><div class="ttname"><a href="structam__ai__acfg.html#ab6bbd9fc037873dca9e838408f1399e7">am_ai_acfg::eAudioApiMode</a></div><div class="ttdeci">ns_audio_api_mode_e eAudioApiMode</div><div class="ttdoc">API Config.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:89</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Audio Inter-process Communication (IPC)</h2>
<p >Capturing audio is an asynchronous task, partially handled by hardware peripherals. AI features which sample audio need a way to run in parallel with the capturing process - NeuralSPOT Audio leverages NeuralSPOT IPC to enable a few ways of doing this:</p><ol type="1">
<li><b>Callback-based</b>: Invokes an IRQ-context callback defined by the application developer. The developer is responsible for buffer management.</li>
<li><b>Ringbuffer-based</b>: adds a ping-ponging ringbuffer allowing the application to run while the next audio buffer is acquired. It builds on the callback approach, preserving flexibility.</li>
</ol>
<h3><a class="anchor" id="autotoc_md40"></a>
Audio IPC Modes</h3>
<p >Audio IPC behavior is controlled by the ns_audio_config_t configuration parameter passed into <code>ns_audio_init</code>. The above example illustrates the callback approach, while the following example shows the <code>ringbuffer</code> approach.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ns__audio_8h.html">ns_audio.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <span class="keyword">static</span> g_audioRecording = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">bool</span> <span class="keyword">static</span> g_audioReady     = <span class="keyword">false</span>;</div>
<div class="line">int16_t <span class="keyword">static</span> g_in16AudioDataBuffer_irq[<a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a> * 2];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Ringbuffer-specific globals</span></div>
<div class="line"><a class="code hl_struct" href="structns__ipc__ring__buffer__t.html">ns_ipc_ring_buffer_t</a> <a class="code hl_variable" href="main_8cc.html#a44328fe803eebb799da0029df9553aaf">audioBuf</a>[1];</div>
<div class="line"><span class="keyword">static</span> uint8_t pui8AudioBuff[<a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a> * 2 * 2]; <span class="comment">// two buffers, 2 bytes/entry</span></div>
<div class="line">int16_t <span class="keyword">static</span> g_in16AudioDataBuffer_app[<a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a> * 2];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This will be called by an IRQ handler</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="main_8cc.html#a6fb724e06717ca9d7f2e87028b728c38">audio_frame_callback</a>(<a class="code hl_struct" href="structam__ai__acfg.html">ns_audio_config_t</a> *config, uint16_t bytesCollected) {</div>
<div class="line">    uint32_t *buffer = (uint32_t *)am_hal_audadc_dma_get_buffer(config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#a3eef71b06c97959fde3aabdd4871dcde">audioSystemHandle</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (g_audioRecording) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#a6cd8a1e15974a310b7e61116c3efee5c">numSamples</a>; i++) {</div>
<div class="line">            g_in16AudioDataBuffer_irq[i] = (int16_t)(pui32_buffer[i] &amp; 0x0000FFF0);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// This is the different part of the callback.</span></div>
<div class="line">        <a class="code hl_function" href="ns__ipc__ring__buffer_8h.html#aa3ae5fa5df9c011842d9269fde555ab0">ns_ipc_ring_buffer_push</a>(&amp;(config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#aa69cc6527be1d7e7f0dc25c8d8539735">bufferHandle</a>[0]),</div>
<div class="line">                                    g_in16AudioDataBuffer_irq,</div>
<div class="line">                                    (config-&gt;<a class="code hl_variable" href="structam__ai__acfg.html#a6cd8a1e15974a310b7e61116c3efee5c">numSamples</a> * 2), <span class="comment">// in bytes</span></div>
<div class="line">                                    <span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">        g_audioReady = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Desired Audio Configuration </span></div>
<div class="line"><a class="code hl_struct" href="structam__ai__acfg.html">ns_audio_config_t</a> <a class="code hl_variable" href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a> = {</div>
<div class="line">    .<a class="code hl_variable" href="structam__ai__acfg.html#ab6bbd9fc037873dca9e838408f1399e7">eAudioApiMode</a> = <a class="code hl_enumvalue" href="group___neural_s_p_o_t-_audio.html#ggac323b3153cc1c87ccdacca907cc10ba7a8eb59c4834d29717a738c5714cc8551e">NS_AUDIO_API_RINGBUFFER</a>, <span class="comment">// Different from callback IPC</span></div>
<div class="line">    .callback = <a class="code hl_function" href="main_8cc.html#a6fb724e06717ca9d7f2e87028b728c38">audio_frame_callback</a>,</div>
<div class="line">    .audioBuffer = (<span class="keywordtype">void</span> *)&amp;pui8AudioBuff,    <span class="comment">// Different from callback IPC</span></div>
<div class="line">    .eAudioSource = <a class="code hl_enumvalue" href="group___neural_s_p_o_t-_audio.html#ggac60456a745861cbe75be2504b3071f32a51878572d9b7fe3281b28a8f8856b658">NS_AUDIO_SOURCE_AUDADC</a>,</div>
<div class="line">    .numChannels = <a class="code hl_define" href="main_8cc.html#ae5597ce31d23d11493e6e674fe257d73">NUM_CHANNELS</a>,</div>
<div class="line">    .numSamples = <a class="code hl_define" href="main_8cc.html#ac51cd4ed73859c0380134f48f2878b1e">SAMPLES_IN_FRAME</a>,</div>
<div class="line">    .sampleRate = <a class="code hl_define" href="main_8cc.html#a4b76a0c2859cfd819a343a780070ee2b">SAMPLE_RATE</a>,</div>
<div class="line">    .audioSystemHandle = NULL,        </div>
<div class="line">    .bufferHandle = <a class="code hl_variable" href="main_8cc.html#a44328fe803eebb799da0029df9553aaf">audioBuf</a>                 <span class="comment">// Different from callback IPC</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="main_8cc.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>) {</div>
<div class="line">    <a class="code hl_function" href="group___neural_s_p_o_t-_audio.html#gac274892f2065523ddc26d0e1846440fb">ns_audio_init</a>(&amp;<a class="code hl_variable" href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="main_8cc.html#ad82f2cf0e099382942e06c6beed540e6">g_intButtonPressed</a> == 1) { <span class="comment">// See NS-peripherals for button info</span></div>
<div class="line">            g_audioRecording = <span class="keyword">true</span>;   <span class="comment">// Tell callback to start collecting audio</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (g_audioReady) {</div>
<div class="line">            <span class="comment">// The callback sets g_audioReady when g_in16AudioDataBuffer has a sample</span></div>
<div class="line">            <span class="comment">// Do something with it...</span></div>
<div class="line">            <a class="code hl_function" href="ns__ipc__ring__buffer_8h.html#a01f86aa46a59d2b5e321b46474af85d3">ns_ipc_ring_buffer_pop</a>(<a class="code hl_variable" href="main_8cc.html#a44328fe803eebb799da0029df9553aaf">audioBuf</a>,</div>
<div class="line">                            &amp;g_in16AudioDataBuffer_app,</div>
<div class="line">                            <a class="code hl_variable" href="main_8cc.html#a3c9efb24bd9b867abc0aef996c03651e">audio_config</a>.<a class="code hl_variable" href="structam__ai__acfg.html#a6cd8a1e15974a310b7e61116c3efee5c">numSamples</a> * 2);</div>
<div class="line">            <a class="code hl_function" href="group___neural_s_p_o_t-_m_f_c_c.html#ga49b1cd702046d3eb44f34f2471f6a080">ns_mfcc_compute</a>(g_in16AudioDataBuffer, &amp;mfcc_buffer[mfcc_buffer_head]);</div>
<div class="line">            g_audioReady = <span class="keyword">false</span>;      <span class="comment">// Tell callback we&#39;re ready for more</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup___neural_s_p_o_t-_audio_html_ggac323b3153cc1c87ccdacca907cc10ba7a8eb59c4834d29717a738c5714cc8551e"><div class="ttname"><a href="group___neural_s_p_o_t-_audio.html#ggac323b3153cc1c87ccdacca907cc10ba7a8eb59c4834d29717a738c5714cc8551e">NS_AUDIO_API_RINGBUFFER</a></div><div class="ttdeci">@ NS_AUDIO_API_RINGBUFFER</div><div class="ttdoc">FreeRTOS ringbuffer is used to send audio to app.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:67</div></div>
<div class="ttc" id="amain_8cc_html_a44328fe803eebb799da0029df9553aaf"><div class="ttname"><a href="main_8cc.html#a44328fe803eebb799da0029df9553aaf">audioBuf</a></div><div class="ttdeci">ns_ipc_ring_buffer_t audioBuf[1]</div><div class="ttdoc">Ringbuffer storage.</div><div class="ttdef"><b>Definition:</b> main.cc:216</div></div>
<div class="ttc" id="ans__ipc__ring__buffer_8h_html_a01f86aa46a59d2b5e321b46474af85d3"><div class="ttname"><a href="ns__ipc__ring__buffer_8h.html#a01f86aa46a59d2b5e321b46474af85d3">ns_ipc_ring_buffer_pop</a></div><div class="ttdeci">uint32_t ns_ipc_ring_buffer_pop(ns_ipc_ring_buffer_t *psBuffer, void *pvDest, uint32_t ui32Bytes)</div><div class="ttdef"><b>Definition:</b> ns_ipc_ring_buffer.c:239</div></div>
<div class="ttc" id="ans__ipc__ring__buffer_8h_html_aa3ae5fa5df9c011842d9269fde555ab0"><div class="ttname"><a href="ns__ipc__ring__buffer_8h.html#aa3ae5fa5df9c011842d9269fde555ab0">ns_ipc_ring_buffer_push</a></div><div class="ttdeci">uint32_t ns_ipc_ring_buffer_push(ns_ipc_ring_buffer_t *psBuffer, void *pvSource, uint32_t ui32Bytes, bool bFullCheck)</div><div class="ttdef"><b>Definition:</b> ns_ipc_ring_buffer.c:134</div></div>
<div class="ttc" id="astructam__ai__acfg_html_aa69cc6527be1d7e7f0dc25c8d8539735"><div class="ttname"><a href="structam__ai__acfg.html#aa69cc6527be1d7e7f0dc25c8d8539735">am_ai_acfg::bufferHandle</a></div><div class="ttdeci">ns_ipc_ring_buffer_t * bufferHandle</div><div class="ttdoc">Filled by init.</div><div class="ttdef"><b>Definition:</b> ns_audio.h:104</div></div>
<div class="ttc" id="astructns__ipc__ring__buffer__t_html"><div class="ttname"><a href="structns__ipc__ring__buffer__t.html">ns_ipc_ring_buffer_t</a></div><div class="ttdef"><b>Definition:</b> ns_ipc_ring_buffer.h:67</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
