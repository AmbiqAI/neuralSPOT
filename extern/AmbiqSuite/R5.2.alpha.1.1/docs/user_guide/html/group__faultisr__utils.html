<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AmbiqSuite User Guide: Fault ISR Utility Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
<link href="paramAlign.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="am_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">AmbiqSuite User Guide<span id="projectnumber">&#160;SDK 5.2.alpha.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">Fault ISR Utility Functions<div class="ingroups"><a class="el" href="group__utils.html">utils</a></div></div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Purpose: This module provides fault handling and analysis utilities for Ambiq Micro devices. It enables fault detection, logging, and recovery mechanisms for handling system faults and exceptions. The utilities support detailed fault analysis and debugging capabilities for robust system operation.</p>
<h1><a class="anchor" id="utils_faultisr_details"></a>
Details</h1>
<p>By default this handler, when included in the build, overrides the weak binding of the default hardfault handler. It allocates 512 bytes of global variable space for a local stack which guarantees diagnostic output under all hardfault conditions. If the local stack is not wanted/needed, define AM_HF_NO_LOCAL_STACK below. If the local stack is disabled, and the SP was invalid at the time of the hardfault, a second hardfault can occur before any diagnostic data is collected or output.</p>
<p>This handler outputs information about the state of the processor at the time the hardfault occurred to stdout (typically SWO). If output is not desired remove the #define AM_UTIL_FAULTISR_PRINT below. When prints are disabled, the fault information is available in the local sHalFaultData structure.</p>
<p>The handler does not return. After outputting the diagnostic information, it spins forever, it does not recover or try and return to the program that caused the hardfault.</p>
<p>Upon entry (caused by a hardfault), it switches to a local stack in case the cause of the hardfault was a stack related issue. The stack is sized large enough to provide for the local variables and the stack space needed for the ouput functions calls being used.</p>
<p>It is compiler/platform independent enabling it to be used with GCC, Keil, IAR and easily ported to other tools chains</p>
<h1><a class="anchor" id="utils_faultisr_features"></a>
Key Features</h1>
<ol type="1">
<li><b>Fault</b> <b>Detection:</b> Comprehensive fault monitoring.</li>
<li><b>Error</b> <b>Logging:</b> Detailed fault information capture.</li>
<li><b>Recovery</b> <b>Handlers:</b> Fault recovery mechanisms.</li>
<li><b>Debug</b> <b>Support:</b> Fault analysis capabilities.</li>
<li><b>System</b> <b>Protection:</b> Critical system preservation.</li>
</ol>
<h1><a class="anchor" id="utils_faultisr_functionality"></a>
Functionality</h1>
<ul>
<li>Initialize fault handlers</li>
<li>Process fault interrupts</li>
<li>Log fault information</li>
<li>Support system recovery</li>
<li>Enable fault analysis</li>
</ul>
<h1><a class="anchor" id="utils_faultisr_usage"></a>
Usage</h1>
<ol type="1">
<li>Initialize fault handling with am_util_faultisr_init()</li>
<li>Configure fault responses</li>
<li>Process faults as they occur</li>
<li>Analyze fault data</li>
</ol>
<h1><a class="anchor" id="utils_faultisr_configuration"></a>
Configuration</h1>
<ul>
<li>Set up fault handler options</li>
<li>Configure logging parameters</li>
<li>Define recovery actions</li>
<li>Set debug information level </li>
</ul>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structam__fault__t.html">am_fault_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga8c4ce712f1949c6da59b9582078fa2f2" id="r_ga8c4ce712f1949c6da59b9582078fa2f2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga8c4ce712f1949c6da59b9582078fa2f2">AM_REG_SYSCTRL_CFSR_O</a>&#160;&#160;&#160;0xE000ED28</td></tr>
<tr class="separator:ga8c4ce712f1949c6da59b9582078fa2f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac06ac103ebf215eb8af16d43f6056d39" id="r_gac06ac103ebf215eb8af16d43f6056d39"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac06ac103ebf215eb8af16d43f6056d39">AM_REG_SYSCTRL_BFAR_O</a>&#160;&#160;&#160;0xE000ED38</td></tr>
<tr class="separator:gac06ac103ebf215eb8af16d43f6056d39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6808fd81811d714c37574e39b467ee63" id="r_ga6808fd81811d714c37574e39b467ee63"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6808fd81811d714c37574e39b467ee63">AM_REGVAL</a>(x)&#160;&#160;&#160;(*((volatile uint32_t *)(x)))</td></tr>
<tr class="separator:ga6808fd81811d714c37574e39b467ee63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac8a4d88272d16420976cd0b9d4adcc0" id="r_gaac8a4d88272d16420976cd0b9d4adcc0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaac8a4d88272d16420976cd0b9d4adcc0">AM_NUM_STACK_RANGES</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:gaac8a4d88272d16420976cd0b9d4adcc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga2ee201927c1baef34f5d54c9402d3141" id="r_ga2ee201927c1baef34f5d54c9402d3141"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2ee201927c1baef34f5d54c9402d3141">am_getStackedReg</a> (uint32_t regnum, uint32_t *u32SP)</td></tr>
<tr class="separator:ga2ee201927c1baef34f5d54c9402d3141"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga275b7f59f04064274abe3fbb04cbe5fd" id="r_ga275b7f59f04064274abe3fbb04cbe5fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga275b7f59f04064274abe3fbb04cbe5fd">am_util_faultisr_collect_data</a> (uint32_t *u32IsrSP)</td></tr>
<tr class="separator:ga275b7f59f04064274abe3fbb04cbe5fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0d176285a2dab5d19805d20d056069ac" id="r_ga0d176285a2dab5d19805d20d056069ac"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0d176285a2dab5d19805d20d056069ac">am_valid_sp</a> (uint32_t *u32IsrSP)</td></tr>
<tr class="separator:ga0d176285a2dab5d19805d20d056069ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga86bcc3461f14641cf13ffa091e9bf911" id="r_ga86bcc3461f14641cf13ffa091e9bf911"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga86bcc3461f14641cf13ffa091e9bf911">am_util_stdio_printf</a> (char *pui8Fmt,...)</td></tr>
<tr class="separator:ga86bcc3461f14641cf13ffa091e9bf911"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga648b3a9fb2df124dfdf3505e144f4cb2" id="r_ga648b3a9fb2df124dfdf3505e144f4cb2"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga648b3a9fb2df124dfdf3505e144f4cb2">gFaultStack</a> [64]</td></tr>
<tr class="separator:ga648b3a9fb2df124dfdf3505e144f4cb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="gaac8a4d88272d16420976cd0b9d4adcc0" name="gaac8a4d88272d16420976cd0b9d4adcc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaac8a4d88272d16420976cd0b9d4adcc0">&#9670;&#160;</a></span>AM_NUM_STACK_RANGES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AM_NUM_STACK_RANGES&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="gac06ac103ebf215eb8af16d43f6056d39" name="gac06ac103ebf215eb8af16d43f6056d39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac06ac103ebf215eb8af16d43f6056d39">&#9670;&#160;</a></span>AM_REG_SYSCTRL_BFAR_O</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AM_REG_SYSCTRL_BFAR_O&#160;&#160;&#160;0xE000ED38</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga8c4ce712f1949c6da59b9582078fa2f2" name="ga8c4ce712f1949c6da59b9582078fa2f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8c4ce712f1949c6da59b9582078fa2f2">&#9670;&#160;</a></span>AM_REG_SYSCTRL_CFSR_O</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AM_REG_SYSCTRL_CFSR_O&#160;&#160;&#160;0xE000ED28</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga6808fd81811d714c37574e39b467ee63" name="ga6808fd81811d714c37574e39b467ee63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6808fd81811d714c37574e39b467ee63">&#9670;&#160;</a></span>AM_REGVAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AM_REGVAL</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>x</em></span></td><td>)</td>
          <td>&#160;&#160;&#160;(*((volatile uint32_t *)(x)))</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga2ee201927c1baef34f5d54c9402d3141" name="ga2ee201927c1baef34f5d54c9402d3141"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2ee201927c1baef34f5d54c9402d3141">&#9670;&#160;</a></span>am_getStackedReg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t am_getStackedReg </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>regnum</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>u32SP</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga275b7f59f04064274abe3fbb04cbe5fd" name="ga275b7f59f04064274abe3fbb04cbe5fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga275b7f59f04064274abe3fbb04cbe5fd">&#9670;&#160;</a></span>am_util_faultisr_collect_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void am_util_faultisr_collect_data </td>
          <td>(</td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>u32IsrSP</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga86bcc3461f14641cf13ffa091e9bf911" name="ga86bcc3461f14641cf13ffa091e9bf911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga86bcc3461f14641cf13ffa091e9bf911">&#9670;&#160;</a></span>am_util_stdio_printf()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t am_util_stdio_printf </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>pui8Fmt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>...</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ga0d176285a2dab5d19805d20d056069ac" name="ga0d176285a2dab5d19805d20d056069ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0d176285a2dab5d19805d20d056069ac">&#9670;&#160;</a></span>am_valid_sp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool am_valid_sp </td>
          <td>(</td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>u32IsrSP</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ga648b3a9fb2df124dfdf3505e144f4cb2" name="ga648b3a9fb2df124dfdf3505e144f4cb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga648b3a9fb2df124dfdf3505e144f4cb2">&#9670;&#160;</a></span>gFaultStack</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t gFaultStack[64]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<hr size="1">
    <body>
        <div id="footer" align="right">        
            <small>
                Generated on Thu Oct 30 2025 19:27:26 for the AmbiqSuite User Guide by&nbsp;
                <a href="http://www.ambiqmicro.com">
                <img class="footer" src="./ambiq_logo.png" alt="Ambiq"/></a>&nbsp&nbsp Copyright &copy; 2025&nbsp&nbsp<br />
                This documentation is licensed and distributed under the <a rel="license" href="http://opensource.org/licenses/BSD-3-Clause">BSD 3-Clause License</a>.&nbsp&nbsp<br/>
            </small>
        </div>
    </body>
</html>
